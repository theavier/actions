name: Keycloak_build

on:
  workflow_dispatch:    # manual trigger from GitHub UI
  #push:
  #  branches: [ main ]  # optional: build on pushes to main

env:
  VERSION: "26.5.1" 

jobs:
  build:    
    name: Building for ${{ matrix.label }}    
    runs-on: windows-latest
    strategy:
      matrix:
        include: 
          - arch: win-x64 
            label: "Windows 64â€‘bit"
    steps:
    - name: Debug information
      run: |
        echo "VERSION: ${{ env.VERSION }}"
        
    - name: Checkout source
      uses: actions/checkout@v5        
      with:
        repository: keycloak/keycloak
        ref: ${{ env.VERSION }}       

    - name: Enable long paths on Windows 
      shell: pwsh
      run: | 
        git config --system core.longpaths true 
        write-output "Long paths enabled"

    - name: Set up JDK 21 
      uses: actions/setup-java@v4 
      with: 
        distribution: temurin 
        java-version: 21 
        cache: maven

    - name: Build Keycloak (skip tests) 
      shell: pwsh 
      run: mvn -B install -DskipTests -Pdistribution
        
    - name: Print current folder path with PowerShell
      shell: pwsh
      run: |
          Write-Output "Current folder path is: $PWD"                            
          
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: Keycloak_${{ env.VERSION }}        
        path: |
            distribution/server-dist/target/*.zip
            distribution/server-dist/target/*.tar.gz
        if-no-files-found: error
